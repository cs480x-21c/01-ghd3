<html>
  <body>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-dispatch.v2.min.js"></script>
    <script src="https://d3js.org/d3-selection.v2.min.js"></script>
    <script src="https://d3js.org/d3-drag.v2.min.js"></script>
    <script>
      var drag = d3.drag();
    </script>
    <div id="main"></div>

    <script>
      console.log({ d3 }); // test if d3 is loaded

      // Add an SVG
      const svg = d3
        .select("#main")
        .append("svg")
        .attr("width", 600)
        .attr("height", 600);

      var toggleColor = (function () {
        var currentColor = "red";

        return function () {
          currentColor = currentColor == "red" ? "magenta" : "red";
          d3.select(this).style("fill", currentColor);
        };
      })();

      var drag = (function () {
        function dragstarted() {
          d3.select(this).attr("stroke", "black");
        }

        function dragged(event, d) {
          d3.select(this)
            .raise()
            .attr("cx", (d.x = event.x))
            .attr("cy", (d.y = event.y));
        }

        function dragended() {
          d3.select(this).attr("stroke", null);
        }

        return d3
          .drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended);
      })();
      // Add Rectangles

      // Add Circles
      svg
        .append("circle")
        .attr("class", "shape circle")
        .attr("cx", 50)
        .attr("cy", 300)
        .attr("r", 25)
        //.on("click", toggleColor)
        //.call(drag)
        .style("fill", "red");
      // Add Lines

      var circleNum = 5;
      // https://observablehq.com/@d3/click-vs-drag?collection=@d3/d3-drag
      const circles = d3.range(circleNum).map((i) => ({
        x: 200 + 50 * i,
        y: 200 + 50 * i,
      }));

      svg
        .selectAll("circle")
        .data(circles)
        .join("circle")
        .attr("cx", (d) => d.x)
        .attr("cy", (d) => d.y)
        .attr("r", 25)
        .attr("fill", (d, i) => d3.schemeCategory10[i % 10])
        .call(drag);

      const linScale = 20;
      const lineData = [
        {
          x1: 1 * linScale,
          y1: 3 * linScale,
          x2: 2 * linScale,
          y2: 1 * linScale,
        },
        {
          x1: 1 * linScale,
          y1: 3 * linScale,
          x2: 3 * linScale,
          y2: 3 * linScale,
        },
        {
          x1: 3 * linScale,
          y1: 3 * linScale,
          x2: 2 * linScale,
          y2: 5 * linScale,
        },
      ];
      svg
        .selectAll("line")
        .data(lineData)
        .enter()
        .append("line")
        .attr("x1", (d) => d.x1)
        .attr("y1", (d) => d.y1)
        .attr("x2", (d) => d.x2)
        .attr("y2", (d) => d.y2)
        .style("stroke", "black")
        .style("stroke-width", 4);

      // Add Polygons
      const polyData = [
        { x: 150, y: 150 },
        { x: 250, y: 150 },
        { x: 250, y: 250 },
        { x: 150, y: 250 },
        { x: 150, y: 150 },
      ];

      var stringPoly = "150, 150 250,150 250,250 150,250 150,150";

      svg.append("polygon").attr("points", stringPoly).style("stroke-width", 4);
    </script>
  </body>
</html>
